# Объединенный модуль GigaAM + Silero VAD

## Модели, используемые в проекте

**VAD модели:**
- Silero VAD 16kHz - универсальная модель детекции речи
- ONNX версии для быстрого инференса и оптимизации производительности

**LLM модели (через LM Studio):**
- qwen3-30b-a3b-instruct-2507-q2ks
- Локальный инференс через http://127.0.0.1:1234

## Основные функции

### GigaAM (распознавание речи)
- Высококачественное распознавание русской речи
- Поддержка различных форматов аудио
- Batch обработка для оптимизации скорости
- Возможность выбора между CTC и RNN-T моделями

### Silero VAD (детекция речи)
- Детекция речевых сегментов в аудиопотоке
- Фильтрация тишины и шумов
- Оптимизация для реального времени
- Поддержка различных порогов чувствительности

### Интеграция VAD + ASR

**`segment_audio(wav_tensor, sample_rate, max_duration=22.0)`**
- Сегментирует длинное аудио на части для ASR
- Использует PyAnnote.audio или локальный Silero VAD
- Автоматическое определение речевых сегментов
- Оптимизация длины сегментов для лучшего качества распознавания

---

# Google Calendar Assistant

Ассистент для создания задач и встреч в Google Calendar через Telegram бота с использованием LM Studio API для локального инференса.

## Функциональность

- Обработка естественного языка для создания событий в календаре через **LM Studio API**
- **Предварительный просмотр и подтверждение событий перед созданием**
- Поддержка указания времени начала, окончания или длительности
- Создание повторяющихся событий
- Интеграция с Telegram для удобного взаимодействия
- Использование OpenAI-совместимого API LM Studio (http://127.0.0.1:1234)
- **Полное логирование всех операций в файл**

## Модули

1. **inference.py** - Модуль инференса с системным промптом, использующий LM Studio API
2. **google_calendar_client.py** - Клиент для работы с Google Calendar API
3. **calendar_service.py** - Сервис, соединяющий инференс и календарь клиент
4. **telegram_bot.py** - Telegram бот для взаимодействия с пользователем
5. **models.py** - Модели данных для событий календаря
6. **utils.py** - Утилиты для работы с датами и временем
7. **logger.py** - Модуль логирования всех операций системы

## Установка и настройка

### 1. Установка LM Studio

1. Скачайте и установите [LM Studio](https://lmstudio.ai/)
2. Загрузите подходящую модель (например, Qwen или LLama)
3. Запустите локальный сервер в LM Studio:
   - Откройте вкладку "Local Server"
   - Выберите модель
   - Нажмите "Start Server"
   - Убедитесь, что сервер работает на `http://127.0.0.1:1234`

### 2. Установка зависимостей Python

```bash
pip install -r requirements.txt
```

### 3. Настройка Google Calendar API

1. Перейдите в [Google Cloud Console](https://console.cloud.google.com/)
2. Создайте новый проект или выберите существующий
3. Включите Google Calendar API
4. Создайте учетные данные (OAuth 2.0 Client ID)
5. Скачайте файл `credentials.json` и поместите в корень проекта

### 4. Настройка Telegram бота

1. Найдите @BotFather в Telegram
2. Создайте нового бота командой `/newbot`
3. Получите токен бота

### 5. Настройка переменных окружения

Скопируйте `.env.example` в `main.env` и заполните необходимые значения:


## Запуск

### 1. Запустите LM Studio Server
- Откройте LM Studio
- Перейдите на вкладку "Local Server"
- Выберите модель и нажмите "Start Server"
- Убедитесь, что API доступен на http://127.0.0.1:1234

### 2. Запустите Calendar Assistant
```bash
python main.py
```



## Примеры использования

### Создание событий
- "Встреча с командой завтра в 14:00 на час"
- "Обед каждый день в 13:00 на 30 минут" 
- "Планерка в понедельник в 10:00"
- "Стоматолог 15 августа в 16:30 описание: профилактический осмотр"

### Процесс создания
1. Отправьте описание события боту
2. Получите структурированное сообщение с деталями события
3. Выберите действие:
   - ✅ **Подтвердить** - создать событие в календаре
   - ❌ **Отменить** - отменить создание
   - ✏️ **Редактировать** - получить текст для редактирования

## Структура проекта

```
selfhosted_assistent/
├── main.py                    # Точка входа
├── inference.py               # Модуль инференса (LM Studio API)
├── google_calendar_client.py  # Google Calendar клиент
├── calendar_service.py        # Сервис календаря
├── telegram_bot.py           # Telegram бот
├── models.py                 # Модели данных
├── utils.py                  # Утилиты
├── logger.py                 # Модуль логирования
├── requirements.txt          # Зависимости Python
├── main.env                 # Пример настроек
├── README.md               # Документация
└── credentials.json        # Учетные данные Google (не в репозитории)
```