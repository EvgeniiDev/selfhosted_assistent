# Объединенный модуль GigaAM + Silero VAD

## Модели, используемые в проекте

**VAD модели:**
- Silero VAD 16kHz - универсальная модель детекции речи
- ONNX версии для быстрого инференса и оптимизации производительности

**LLM модели (через LM Studio):**
- qwen3-30b-a3b-instruct-2507-q2ks
- Локальный инференс через http://127.0.0.1:1234

## Основные функции

### GigaAM (распознавание речи)
- Высококачественное распознавание русской речи
- Поддержка различных форматов аудио
- Batch обработка для оптимизации скорости
- Возможность выбора между CTC и RNN-T моделями

### Silero VAD (детекция речи)
- Детекция речевых сегментов в аудиопотоке
- Фильтрация тишины и шумов
- Оптимизация для реального времени
- Поддержка различных порогов чувствительности

### Интеграция VAD + ASR

**`segment_audio(wav_tensor, sample_rate, max_duration=22.0)`**
- Сегментирует длинное аудио на части для ASR
- Использует PyAnnote.audio или локальный Silero VAD
- Автоматическое определение речевых сегментов
- Оптимизация длины сегментов для лучшего качества распознавания

---

# Google Calendar Assistant

Ассистент для создания задач и встреч в Google Calendar, а также для сохранения заметок через Telegram бота с использованием LM Studio API для локального инференса.

## Функциональность

- Обработка естественного языка для создания событий в календаре через **LM Studio API**
- **Автоматическое определение типа запроса: календарное событие или заметка**
- **Предварительный просмотр и подтверждение событий перед созданием**
- **Мгновенное сохранение и отображение заметок**
- Поддержка указания времени начала, окончания или длительности для событий
- Создание повторяющихся событий
- Интеграция с Telegram для удобного взаимодействия
- Использование OpenAI-совместимого API LM Studio (http://127.0.0.1:1234)
- **Полное логирование всех операций в файл**

## Модули

1. **request_classifier.py** - Модуль классификации запросов с системным промптом, использующий LM Studio API для определения типа запроса (событие или заметка)
2. **google_calendar_client.py** - Клиент для работы с Google Calendar API
3. **assistant_service.py** - Основной сервис ассистента, обрабатывающий как события, так и заметки
4. **telegram_bot.py** - Telegram бот для взаимодействия с пользователем
5. **models.py** - Модели данных для событий календаря и заметок
6. **utils.py** - Утилиты для работы с датами и временем
7. **logger.py** - Модуль логирования всех операций системы

## Установка и настройка

### 1. Установка LM Studio

1. Скачайте и установите [LM Studio](https://lmstudio.ai/)
2. Загрузите подходящую модель (например, Qwen или LLama)
3. Запустите локальный сервер в LM Studio:
   - Откройте вкладку "Local Server"
   - Выберите модель
   - Нажмите "Start Server"
   - Убедитесь, что сервер работает на `http://127.0.0.1:1234`

### 2. Установка зависимостей Python

```bash
pip install -r requirements.txt
```

### 3. Настройка Google Calendar API

1. Перейдите в [Google Cloud Console](https://console.cloud.google.com/)
2. Создайте новый проект или выберите существующий
3. Включите Google Calendar API
4. Создайте учетные данные (OAuth 2.0 Client ID)
5. Скачайте файл `credentials.json` и поместите в корень проекта

### 4. Настройка Telegram бота

1. Найдите @BotFather в Telegram
2. Создайте нового бота командой `/newbot`
3. Получите токен бота

### 5. Настройка переменных окружения

Скопируйте `.env.example` в `main.env` и заполните необходимые значения:


## Запуск

### 1. Запустите LM Studio Server
- Откройте LM Studio
- Перейдите на вкладку "Local Server"
- Выберите модель и нажмите "Start Server"
- Убедитесь, что API доступен на http://127.0.0.1:1234

### 2. Запустите Calendar Assistant
```bash
python main.py
```



## Примеры использования

### Создание календарных событий
- "Встреча с командой завтра в 14:00 на час"
- "Обед каждый день в 13:00 на 30 минут" 
- "Планерка в понедельник в 10:00"
- "Стоматолог 15 августа в 16:30 описание: профилактический осмотр"

### Создание заметок
- "Нужно купить молоко и хлеб"
- "Запомни: у Саши день рождения 15 числа"
- "Идея для проекта: создать чат-бот для заказов"
- "Номер телефона службы поддержки: +7-123-456-78-90"

### Процесс создания событий
1. Отправьте описание события боту
2. Получите структурированное сообщение с деталями события
3. Выберите действие:
   - ✅ **Подтвердить** - создать событие в календаре
   - ❌ **Отменить** - отменить создание
   - ✏️ **Редактировать** - получить текст для редактирования

### Процесс создания заметок
1. Отправьте текст заметки боту
2. Система автоматически определит, что это заметка
3. Получите красиво отформатированную заметку с названием, содержимым, датой создания и тегами

## Структура проекта

```
selfhosted_assistent/
├── main.py                      # Точка входа
├── request_classifier.py        # Классификатор запросов (LM Studio API) для событий и заметок
├── google_calendar_client.py    # Google Calendar клиент
├── assistant_service.py         # Основной сервис ассистента
├── telegram_bot.py             # Telegram бот
├── models.py                   # Модели данных (CalendarEvent, Note)
├── utils.py                    # Утилиты
├── logger.py                   # Модуль логирования
├── voice_service.py            # Сервис распознавания речи
├── requirements.txt            # Зависимости Python
├── main.env                   # Пример настроек
├── README.md                  # Документация
└── credentials.json           # Учетные данные Google (не в репозитории)
```